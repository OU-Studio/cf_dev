<!doctype html>
<html class="js" lang="{{ request.locale.iso_code }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="">
    <link rel="canonical" href="{{ canonical_url }}">

    <link rel="stylesheet" href="https://use.typekit.net/wlt3jps.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js" integrity="sha512-XtmMtDEcNz2j7ekrtHvOVR4iwwaD6o/FUJe6+Zq+HgcCsk3kj4uSQQR8weQ2QVj1o0Pk6PwYLohm206ZzNfubg==" crossorigin="anonymous" referrerpolicy="no-referrer" ></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.js"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css"
      integrity="sha512-17EgCFERpgZKcm0j0fEq1YCJuyAWdz9KUtv1EjVuaOz8pDnh/0nZxmU6BBXwaaxqoi9PQXnRWqlcDB027hgv9A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    >
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"
      integrity="sha512-yHknP1/AwR+yx26cB1y0cjvQUMvEa2PFzt1c9LlS4pRQ5NOTZFWbhBig+X9G9eYW/8m0/4OXNx8pxJ6z57x0dw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    >

    <script>
      // Ensure jQuery + Slick loaded before this file.
(function ($, win, doc) {
  'use strict';

  // ---------- Helpers ----------
  const hasSlick = typeof $.fn.slick === 'function';

  const DOT_SVG = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 141.73 42.52" aria-hidden="true" focusable="false">
      <path d="M138.41,4.06c-.43-.56-.93-1.05-1.48-1.47-1.47-1.33-3.51-2.02-5.62-1.7-2.24.33-4.06,1.72-5.05,3.58-.29.49-.52,1.01-.68,1.55-.58,2.01-.14,4.03,1.18,5.67,1.46,2.01,3.95,3.15,6.57,2.76,1.3-.19,2.46-.74,3.4-1.53-.27,2.22-1.03,4.29-2.32,6.32-4.31,5.52-9.5,8.87-15,9.7-8.64,1.29-15.98-3.71-19.42-9.25-7.42-11.94-13.07-12.29-17.79-11.68-4.79.96-8.93,3.81-11.38,7.81-2.45-4.01-6.59-6.85-11.38-7.81-4.72-.61-10.37-.26-17.79,11.68-3.44,5.54-10.78,10.54-19.42,9.25-5.5-.82-10.69-4.18-15-9.7-1.29-2.03-2.05-4.1-2.32-6.32.94.79,2.1,1.34,3.4,1.53,2.62.39,5.11-.75,6.57-2.76,1.32-1.64,1.76-3.66,1.18-5.67-.16-.54-.39-1.06-.68-1.55-.98-1.86-2.81-3.24-5.05-3.58-2.12-.32-4.15.37-5.62,1.7-.55.42-1.05.91-1.48,1.47-1.72,2.22-2.36,5.36-1.91,9.31.43,3.82,1.62,6.59,3.55,10.1,6.38,9.51,16.22,15.31,29.22,17.26,12.91,1.93,24.16-.78,24.27-.81,1.66-.41,9.47-3.24,12.46-8.77,2.99,5.52,10.8,8.36,12.46,8.77.11.03,11.36,2.74,24.27.81,13.01-1.95,22.84-7.75,29.22-17.26,1.92-3.51,3.12-6.29,3.55-10.1.45-3.96-.2-7.09-1.91-9.31Z"/>
    </svg>
  `;

  const slickDots = {
    dots: true,
    dotsClass: 'slick-dots ou-dots',
    customPaging: (_slick, i) => `
      <button type="button" class="ou-dot" aria-label="Go to slide ${i + 1}">
        ${DOT_SVG}
      </button>
    `
  };

  const initSlickOnce = ($el, opts) => {
    if (!hasSlick || !$el.length) return;
    $el.filter(':not(.slick-initialized)').slick(opts);
  };

  // ---------- Lightbox: Museum visit ----------
  const appendMatterportOnce = () => {
    if (doc.querySelector('.lbCover')) return; // already open

    const wrap = doc.createElement('div');
    wrap.className = 'lbWrap';
    wrap.innerHTML = `
      <div class="lbCover" role="button" aria-label="Close"></div>
      <div class="lbClose" aria-label="Close"></div>
      <div class="embed-container" role="dialog" aria-modal="true" aria-label="Museum tour">
        <iframe width="853" height="480"
          src="https://my.matterport.com/show/?m=E9G6257KNrd"
          frameborder="0" allowfullscreen
          allow="xr-spatial-tracking"></iframe>
      </div>
      <style>
        .lbWrap{position:fixed;inset:0;z-index:9999}
        .embed-container{position:absolute;inset:10% 5%;max-width:1200px;margin:auto;left:0;right:0;background:#000}
        .embed-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%}
        .embed-container iframe{position:absolute;top:0;left:0;width:100%;height:100%}
      </style>
    `;
    doc.body.appendChild(wrap);

    const close = () => wrap.remove();
    wrap.querySelector('.lbCover')?.addEventListener('click', close);
    wrap.querySelector('.lbClose')?.addEventListener('click', close);
    doc.addEventListener('keydown', (e) => (e.key === 'Escape') && close(), { once: true });
  };

  const initMuseum = () => {
    const $btn = $('#visit-museum');
    if ($btn.length) {
      $btn.off('click.ouMuseum').on('click.ouMuseum', (e) => {
        e.preventDefault();
        appendMatterportOnce();
      });
    }
  };

  document.addEventListener('click', (e) => {
  const btn = e.target.closest('.shuffle');
  if (!btn) return;

  const container = btn.parentElement.querySelector('.custom-image-links');
  if (!container) return;

  const items = Array.from(container.children);
  const original = [...items];
  let shuffled = [];

  // Derangement shuffle (no element stays in same position)
  do {
    shuffled = [...original];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
  } while (shuffled.some((item, i) => item === original[i]));

  // Re-append in new order
  shuffled.forEach(item => container.appendChild(item));

  // Smooth scroll to #cardTop after short delay
  const target = document.querySelector('#cardTop');
  if (target) {
    setTimeout(() => {
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 150); // small delay to allow DOM update
  }
});




  // ---------- Notes sliders ----------
  const initNotesSliders = () => {
    const $labels = $('.inline-richtext');
    if (!$labels.length) return;

    $labels.each(function () {
      const txt = $(this).text().trim();
      if (txt === 'TOP NOTES' || txt === 'Expedition Mug') {
        const $ul = $(this).closest('ul').addClass('notesSlider');
        if (!hasSlick) return;

        // mobile-only for TOP NOTES; always for Expedition Mug (preserving your logic)
        const shouldInit =
          (txt === 'TOP NOTES' && win.innerWidth < 900) || (txt === 'Expedition Mug');

        if (shouldInit) {
          initSlickOnce($ul, {
            slidesToShow: 1,
            slidesToScroll: 1,
            centerMode: false,
            swipeToSlide: true,
            infinite: false,
            arrows: false,
            dots: false
          });
        }
      }
    });
  };

  // ---------- Collapsible rows ----------
  const initCollapsibles = () => {
    const $rows = $('.collapsible-row');
    if (!$rows.length) return;

    // start collapsed
    $rows.find('.collapsible-content').each(function () {
      $(this).stop(true, true).slideUp(0);
    });

    // delegate clicks on h2 inside .collapsible-row
    $(doc).off('click.ouCollapse', '.collapsible-row h2')
      .on('click.ouCollapse', '.collapsible-row h2', function () {
        $(this).next('.collapsible-content').stop(true, true).slideToggle(300);
      });
  };

  // ---------- Slideshows ----------
  const initSlideshows = () => {
    if (!hasSlick) return;

    // Non full-bleed
    initSlickOnce($('.section:not(.full-bleed) .slideshow-container'), {
      slidesToShow: 1,
      slidesToScroll: 1,
      centerMode: true,
      swipeToSlide: true,
      infinite: true,
      arrows: true,
      ...slickDots
    });

    // Full-bleed (autoplay, no arrows)
    initSlickOnce($('.full-bleed .slideshow-container'), {
      slidesToShow: 1,
      slidesToScroll: 1,
      centerMode: true,
      swipeToSlide: true,
      infinite: true,
      arrows: false,
      autoplay: true,
      autoplaySpeed: 5000,
      ...slickDots
    });
  };

  // ---------- Product media + buy block ----------
  const initProductMedia = () => {
    const $media = $('.product__media-list');
    if (!$media.length) return;

    initSlickOnce($media, {
      slidesToShow: 1,
      slidesToScroll: 1,
      centerMode: true,
      swipeToSlide: true,
      infinite: true,
      arrows: true,
      dots: true
    });

    // Group buy buttons + qty input
    const $formInput = $('.product-form__input').first();
    const $buyButtons = $('.prodBuyButtons').first();

    if ($formInput.length || $buyButtons.length) {
      const $wrap = $('<div class="qandb"></div>');
      $wrap.insertBefore($formInput.length ? $formInput : $buyButtons);
      if ($buyButtons.length) $buyButtons.prependTo($wrap);
      if ($formInput.length) $formInput.prependTo($wrap);
    }
  };

  // ---------- Boot ----------
  // Use window load for image-dependent slick sizing; move light DOM work to DOMContentLoaded if desired.
  $(win).on('load', function () {
    initMuseum();
    initNotesSliders();
    initCollapsibles();
    initSlideshows();
    initProductMedia();
  });

})(jQuery, window, document);

    </script>

    {%- if settings.favicon != blank -%}
      <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
    {%- endif -%}

    <title>
      {{ page_title }}
      {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
      {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
      {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
    </title>

    {% if page_description %}
      <meta name="description" content="{{ page_description | escape }}">
    {% endif %}

    {% render 'meta-tags' %}

    <script src="{{ 'constants.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'pubsub.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'global.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'details-disclosure.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'details-modal.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'search-form.js' | asset_url }}" defer="defer"></script>

    {%- if settings.animations_reveal_on_scroll -%}

    {%- endif -%}

    {{ content_for_header }}


    <link rel="stylesheet" href="{{ 'base.css' | asset_url }}?t={{ 'now' | date: '%s' }}">


    <style>
      :root {
        --empera-large-size: {{ settings.empera_large_size }}px;
        --empera-large-line-height: {{ settings.empera_large_line_height }}em;
        --empera-large-letter-spacing: {{ settings.empera_large_letter_spacing }}px;
        --empera-large-weight: {{ settings.empera_large_weight }};
        --empera-large-style: {{ settings.empera_large_style }};

  /*font-feature-settings: 'swsh' on;*/

        --garamond-large-size: {{ settings.garamond_large_size }}px;
        --garamond-large-line-height: {{ settings.garamond_large_line_height }}em;
        --garamond-large-letter-spacing: {{ settings.garamond_large_letter_spacing }}px;
        --garamond-large-weight: {{ settings.garamond_large_weight }};
        --garamond-large-style: {{ settings.garamond_large_style }};

        --empera-small-size: {{ settings.empera_small_size }}px;
        --empera-small-line-height: {{ settings.empera_small_line_height }}em;
        --empera-small-letter-spacing: {{ settings.empera_small_letter_spacing }}px;
        --empera-small-weight: {{ settings.empera_small_weight }};
        --empera-small-style: {{ settings.empera_small_style }};

        --garamond-small-size: {{ settings.garamond_small_size }}px;
        --garamond-small-line-height: {{ settings.garamond_small_line_height }}em;
        --garamond-small-letter-spacing: {{ settings.garamond_small_letter_spacing }}px;
        --garamond-small-weight: {{ settings.garamond_small_weight }};
        --garamond-small-style: {{ settings.garamond_small_style }};

        --garamond-tiny-size: {{ settings.garamond_tiny_size }}px;
        --garamond-tiny-line-height: {{ settings.garamond_tiny_line_height }}em;
        --garamond-tiny-letter-spacing: {{ settings.garamond_tiny_letter_spacing }}px;
        --garamond-tiny-weight: {{ settings.garamond_tiny_weight }};
        --garamond-tiny-style: {{ settings.garamond_tiny_style }};

        --norwester-large-size: {{ settings.norwester_large_size }}px;
        --norwester-large-line-height: {{ settings.norwester_large_line_height }}em;
        --norwester-large-letter-spacing: {{ settings.norwester_large_letter_spacing }}px;
        --norwester-large-weight: {{ settings.norwester_large_weight }};
        --norwester-large-style: {{ settings.norwester_large_style }};

        --norwester-small-size: {{ settings.norwester_small_size }}px;
        --norwester-small-line-height: {{ settings.norwester_small_line_height }}em;
        --norwester-small-letter-spacing: {{ settings.norwester_small_letter_spacing }}px;
        --norwester-small-weight: {{ settings.norwester_small_weight }};
        --norwester-small-style: {{ settings.norwester_small_style }};

        --red: #A30000;
        --black: #000000;
        --grey: #000000;
      
        /*
            --cream:rgb(43, 206, 218);
        --offwhite:rgb(91, 129, 40);            
*/
        
        --white: #ffffff;
        
        --cream: #FFFDF3;
        --offwhite: #FAF6EC;
        

      }
    </style>

    <link rel="stylesheet" href="{{ 'component-cart-items.css' | asset_url }}" media="print" onload="this.media='all'">

    {%- if settings.cart_type == 'drawer' -%}
      {{ 'component-cart-drawer.css' | asset_url | stylesheet_tag }}
      {{ 'component-cart.css' | asset_url | stylesheet_tag }}
      {{ 'component-totals.css' | asset_url | stylesheet_tag }}
      {{ 'component-price.css' | asset_url | stylesheet_tag }}
      {{ 'component-discounts.css' | asset_url | stylesheet_tag }}
    {%- endif -%}

    {%- if localization.available_countries.size > 1 or localization.available_languages.size > 1 -%}
      {{ 'component-localization-form.css' | asset_url | stylesheet_tag: preload: true }}
      <script src="{{ 'localization-form.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {%- if settings.predictive_search_enabled -%}
      <link
        rel="stylesheet"
        href="{{ 'component-predictive-search.css' | asset_url }}"
        media="print"
        onload="this.media='all'"
      >
    {%- endif -%}

    <script>
      if (Shopify.designMode) {
        document.documentElement.classList.add('shopify-design-mode');
      }
    </script>


  </head>

  <body class="gradient{% if settings.animations_hover_elements != 'none' %} animate--hover-{{ settings.animations_hover_elements }}{% endif %}" data-url="{{ request.path }}" data-template="{{ template }}">
    <div class="bgelms">
    <div class="bgelm compass"></div>
    <div class="bgelm octopus"></div>
    <div class="bgelm boat"></div>
    <div class="sigelm"></div>
    </div>

    {%- if settings.cart_type == 'drawer' -%}
      {%- render 'cart-drawer' -%}
    {%- endif -%}

    {% sections 'header-group' %}

    <main id="MainContent" class="content-for-layout focus-none" role="main" tabindex="-1">
      {{ content_for_layout }}
    </main>

    <ul hidden>
      <li id="a11y-refresh-page-message">{{ 'accessibility.refresh_page' | t }}</li>
      <li id="a11y-new-window-message">{{ 'accessibility.link_messages.new_window' | t }}</li>
    </ul>

    <script>
      window.shopUrl = '{{ request.origin }}';
      window.routes = {
        cart_add_url: '{{ routes.cart_add_url }}',
        cart_change_url: '{{ routes.cart_change_url }}',
        cart_update_url: '{{ routes.cart_update_url }}',
        cart_url: '{{ routes.cart_url }}',
        predictive_search_url: '{{ routes.predictive_search_url }}',
      };

      window.cartStrings = {
        error: `{{ 'sections.cart.cart_error' | t }}`,
        quantityError: `{{ 'sections.cart.cart_quantity_error_html' | t: quantity: '[quantity]' }}`,
      };

      window.variantStrings = {
        addToCart: `{{ 'products.product.add_to_cart' | t }}`,
        soldOut: `{{ 'products.product.sold_out' | t }}`,
        unavailable: `{{ 'products.product.unavailable' | t }}`,
        unavailable_with_option: `{{ 'products.product.value_unavailable' | t: option_value: '[value]' }}`,
      };

      window.quickOrderListStrings = {
        itemsAdded: `{{ 'sections.quick_order_list.items_added.other' | t: quantity: '[quantity]' }}`,
        itemAdded: `{{ 'sections.quick_order_list.items_added.one' | t: quantity: '[quantity]' }}`,
        itemsRemoved: `{{ 'sections.quick_order_list.items_removed.other' | t: quantity: '[quantity]' }}`,
        itemRemoved: `{{ 'sections.quick_order_list.items_removed.one' | t: quantity: '[quantity]' }}`,
        viewCart: `{{- 'sections.quick_order_list.view_cart' | t -}}`,
        each: `{{- 'sections.quick_order_list.each' | t: money: '[money]' }}`,
        min_error: `{{- 'sections.quick_order_list.min_error' | t: min: '[min]' }}`,
        max_error: `{{- 'sections.quick_order_list.max_error' | t: max: '[max]' }}`,
        step_error: `{{- 'sections.quick_order_list.step_error' | t: step: '[step]' }}`,
      };

      window.accessibilityStrings = {
        imageAvailable: `{{ 'products.product.media.image_available' | t: index: '[index]' }}`,
        shareSuccess: `{{ 'general.share.success_message' | t }}`,
        pauseSlideshow: `{{ 'sections.slideshow.pause_slideshow' | t }}`,
        playSlideshow: `{{ 'sections.slideshow.play_slideshow' | t }}`,
        recipientFormExpanded: `{{ 'recipient.form.expanded' | t }}`,
        recipientFormCollapsed: `{{ 'recipient.form.collapsed' | t }}`,
        countrySelectorSearchCount: `{{ 'localization.country_results_count' | t: count: '[count]' }}`,
      };
    </script>

    {%- if settings.predictive_search_enabled -%}
      <script src="{{ 'predictive-search.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {%- if settings.cart_type == 'drawer' -%}
      <script src="{{ 'cart-drawer.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {% sections 'footer-group' %}

    <script>
(() => {
  const container = document.getElementById('ou-reviews');
  const jsonEl = document.getElementById('shop-reviews-data');
  if (!container || !jsonEl) return;

  let reviews = [];
  try {
    reviews = JSON.parse(jsonEl.textContent || '[]') || [];
  } catch(e) {
    console.warn('Invalid shop reviews JSON', e);
    return;
  }

  // Read controls
  const indicesStr = (container.dataset.indices || '').replace(/\s+/g, '');
  const count = parseInt(container.dataset.count || '4', 10);
  const random = (container.dataset.random || 'true') === 'true';
  const minRating = parseInt(container.dataset.minRating || '0', 10);

  // Filter by rating
  const eligible = reviews
    .map((r, i) => ({...r, _i: i}))
    .filter(r => (parseInt(r.rating || 0, 10) >= minRating));

  // Pick indexes
  let picked = [];
  if (indicesStr) {
    // explicit 1-based â†’ 0-based
    const wanted = indicesStr.split(',').map(n => parseInt(n, 10) - 1);
    picked = wanted
      .filter(i => i >= 0 && i < reviews.length)
      .map(i => ({...reviews[i], _i: i}));
  } else {
    let pool = [...eligible];
    if (random) {
      for (let i = pool.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [pool[i], pool[j]] = [pool[j], pool[i]];
      }
    }
    picked = pool.slice(0, Math.max(0, count));
  }

  if (!picked.length) {
    container.innerHTML = '<p>No reviews matched.</p>';
    return;
  }

  // Render
  const starHTML = (n) => {
    const rating = Math.max(0, Math.min(5, parseInt(n || 0, 10)));
    let s = '';
    for (let i = 1; i <= 5; i++) s += `<span class="ou-star${i <= rating ? ' is-filled' : ''}" ><svg width="24" height="23" viewBox="0 0 24 23" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M16.5906 14.0532L19.4195 22.7302L12 17.3874L4.67114 22.7603L7.45973 14.0632L0 8.69035H9.19127L12 0.0234375L14.8087 8.71044H24L16.5906 14.0532Z" fill="#A30000"/>
</svg>
</span>`;
    return `<div class="ou-review__stars" aria-label="${rating} out of 5">${s}</div>`;
  };

  const escapeHTML = (str) => String(str || '')
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');

  container.innerHTML = picked.map(r => `
    <article class="ou-review" itemscope itemtype="https://schema.org/Review">
      ${r.rating ? `<div itemprop="reviewRating" itemscope itemtype="https://schema.org/Rating">
          <meta itemprop="worstRating" content="1"><meta itemprop="bestRating" content="5">
          <meta itemprop="ratingValue" content="${parseInt(r.rating,10)}">
          ${starHTML(r.rating)}
        </div>` : ''}
      ${r.text ? `<blockquote class="ou-review__text" itemprop="reviewBody">${escapeHTML(r.text)}</blockquote>` : ''}
      ${r.author ? `<p class="ou-review__meta"><span itemprop="author">${escapeHTML(r.author)}</span></p>` : ''}
    </article>
  `).join('');
})();
</script>

  </body>
</html>


